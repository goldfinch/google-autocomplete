(function(l){window.googleFieldsInit=()=>{};function f(e,o,a,i,d){a.value=o.lat(),i.value=o.lng(),d.value=e.getZoom()}function h(e,o,a,i,d,s){const t=l(a.currentTarget).val();t&&(geocoder=new google.maps.Geocoder,geocoder.geocode({address:t},(p,n)=>{if(l(a).removeClass("ggp-place-found"),l(a).removeClass("ggp-place-failed"),google.maps.GeocoderStatus.OK===n){const{location:r}=p[0].geometry;o.setPosition(r),e.panTo(r),l(a.currentTarget).addClass("ggp-place-found"),clearTimeout(window.placeFoundTimeout),window.placeFoundTimeout=setTimeout(()=>l(a.currentTarget).removeClass("ggp-place-found"),1e3),f(e,r,i,d,s)}else console.warn(`Find a place: ${t} not found`),l(a.currentTarget).addClass("ggp-place-failed"),clearTimeout(window.placeFailedTimeout),window.placeFailedTimeout=setTimeout(()=>l(a.currentTarget).removeClass("ggp-place-failed"),1e3)})),a.preventDefault(),a.stopPropagation()}function u(){l("[data-goldfinch-google-place-field]").each((e,o)=>{const a=l(o).find('[data-goldfinch-place="data"]');if(a.length&&a.val()){const i=JSON.parse(l(o).find('[data-goldfinch-place="data"]').val()),d=l(o).find('[data-goldfinch-place="preview"]');d.addClass("ggp__preview--display");const s=l("<ul>");i.address_components.forEach((t,p)=>{let n=t.types.join();t.types.includes("subpremise")?n="Subpremise":t.types.includes("street_number")?n="Street number":t.types.includes("route")?n="Street name":t.types.includes("locality")?n="Suburb":t.types.includes("sublocality")?n="Subarea":t.types.includes("administrative_area_level_1")?n="Region":t.types.includes("administrative_area_level_2")?n="District":t.types.includes("country")?n="Country":t.types.includes("postal_code")&&(n="Postcode"),s.append(`<li><b>${n}</b>: ${t.long_name}</li>`)});const{location:c}=i.geometry;s.append(`<li><b>Latitude</b>: ${c.lat}</li>`),s.append(`<li><b>Longitude</b>: ${c.lng}</li>`),s.append(`<li><a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${c.lat},${c.lng}">Open Google Maps</a></li>`),d.html(s)}})}l(document).ready(()=>{u()}),l(".cms-edit-form").entwine({onmatch(e){this._super(e)},onunmatch(e){this._super(e)},onaftersubmitform(e,o){u()}}),l.entwine("ss",e=>{e("[data-goldfinch-google-place-field]").entwine({onmatch(){const o=e(this).find('[data-goldfinch-place="address"]')[0],a=e(this).find('[data-goldfinch-place="data"]')[0],d={componentRestrictions:{country:JSON.parse(e(o).attr("data-settings")).country},fields:["address_components","geometry","name"],strictBounds:!1},s=new google.maps.places.Autocomplete(o,d);s.addListener("place_changed",()=>{const c=s.getPlace();a.value=JSON.stringify(c),u()})}}),e("[data-goldfinch-google-map-field]").entwine({onmatch(){const o=e(this).find('[data-goldfinch-map="latitude"]')[0],a=e(this).find('[data-goldfinch-map="longitude"]')[0],i=e(this).find('[data-goldfinch-map="zoom"]')[0],d=e(this).find('[data-goldfinch-map="frame"]')[0],s=e(this).find('[data-goldfinch-map="search"]')[0],c=JSON.parse(e(d).attr("data-settings"));let t=parseFloat(o.value),p=parseFloat(a.value),n=parseFloat(i.value);n||(n=c.zoom),t||(t=c.lat),p||(p=c.lng);const r=new google.maps.Map(d,{center:{lat:t,lng:p},zoom:n,gestureHandling:"cooperative",fullscreenControl:!1,mapTypeControl:!1,clickableIcons:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!1}),m=new google.maps.Marker({position:{lat:t,lng:p},map:r});google.maps.event.addListener(r,"zoom_changed",g=>{i.value=r.getZoom()}),google.maps.event.addListener(r,"click",g=>{m.setPosition(g.latLng),r.panTo(g.latLng),f(r,g.latLng,o,a,i)}),e(s).on({change:s,keydown:g=>{g.which==13&&h(r,m,g,o,a,i)}})}})})})(jQuery);
