(function(n){window.googleFieldsInit=()=>{};function f(t,o,e,i,c){e.value=o.lat(),i.value=o.lng(),c.value=t.getZoom()}function h(t,o,e,i,c,s){var a=n(e.currentTarget).val();a&&(geocoder=new google.maps.Geocoder,geocoder.geocode({address:a},(p,l)=>{if(n(e).removeClass("ggp-place-found"),n(e).removeClass("ggp-place-failed"),google.maps.GeocoderStatus.OK===l){let r=p[0].geometry.location;o.setPosition(r),t.panTo(r),n(e.currentTarget).addClass("ggp-place-found"),clearTimeout(window.placeFoundTimeout),window.placeFoundTimeout=setTimeout(()=>n(e.currentTarget).removeClass("ggp-place-found"),1e3),f(t,r,i,c,s)}else console.warn("Find a place: "+a+" not found"),n(e.currentTarget).addClass("ggp-place-failed"),clearTimeout(window.placeFailedTimeout),window.placeFailedTimeout=setTimeout(()=>n(e.currentTarget).removeClass("ggp-place-failed"),1e3)})),e.preventDefault(),e.stopPropagation()}function u(){n("[data-goldfinch-google-place-field]").each((t,o)=>{let e=n(o).find('[data-goldfinch-place="data"]');if(e.length&&e.val()){let i=JSON.parse(n(o).find('[data-goldfinch-place="data"]').val()),c=n(o).find('[data-goldfinch-place="preview"]'),s=n("<ul>");i.address_components.forEach((a,p)=>{let l=a.types.join();a.types.includes("subpremise")?l="Subpremise":a.types.includes("street_number")?l="Street number":a.types.includes("route")?l="Street name":a.types.includes("locality")?l="Suburb":a.types.includes("sublocality")?l="Subarea":a.types.includes("administrative_area_level_1")?l="Region":a.types.includes("administrative_area_level_2")?l="District":a.types.includes("country")?l="Country":a.types.includes("postal_code")&&(l="Postcode"),s.append("<li><b>"+l+"</b>: "+a.long_name+"</li>")});let d=i.geometry.location;s.append("<li><b>Latitude</b>: "+d.lat+"</li>"),s.append("<li><b>Longitude</b>: "+d.lng+"</li>"),s.append('<li><a target="_blank" href="https://www.google.com/maps/search/?api=1&query='+d.lat+","+d.lng+'">Open Google Maps</a></li>'),c.html(s)}})}n(document).ready(()=>{u()}),n.entwine("ss",function(t){t("[data-goldfinch-google-place-field]").entwine({onmatch:function(){var o=t(this).find('[data-goldfinch-place="address"]')[0],e=t(this).find('[data-goldfinch-place="data"]')[0],i=JSON.parse(t(o).attr("data-settings"));const c={componentRestrictions:{country:i.country},fields:["address_components","geometry","name"],strictBounds:!1},s=new google.maps.places.Autocomplete(o,c);s.addListener("place_changed",()=>{const d=s.getPlace();e.value=JSON.stringify(d),u()})}}),t("[data-goldfinch-google-map-field]").entwine({onmatch:function(){var o=t(this).find('[data-goldfinch-map="latitude"]')[0],e=t(this).find('[data-goldfinch-map="longitude"]')[0],i=t(this).find('[data-goldfinch-map="zoom"]')[0],c=t(this).find('[data-goldfinch-map="frame"]')[0],s=t(this).find('[data-goldfinch-map="search"]')[0],d=JSON.parse(t(c).attr("data-settings"));let a=parseFloat(o.value),p=parseFloat(e.value),l=parseFloat(i.value);l||(l=d.zoom),a||(a=d.lat),p||(p=d.lng);let r=new google.maps.Map(c,{center:{lat:a,lng:p},zoom:l,gestureHandling:"cooperative",fullscreenControl:!1,mapTypeControl:!1,clickableIcons:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!1});var m=new google.maps.Marker({position:{lat:a,lng:p},map:r});google.maps.event.addListener(r,"zoom_changed",g=>{i.value=r.getZoom()}),google.maps.event.addListener(r,"click",g=>{m.setPosition(g.latLng),r.panTo(g.latLng),f(r,g.latLng,o,e,i)}),t(s).on({change:s,keydown:g=>{g.which==13&&h(r,m,g,o,e,i)}})}})})})(jQuery);
