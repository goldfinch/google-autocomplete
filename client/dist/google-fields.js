(function(n){window.googleFieldsInit=()=>{};function f(e,l,a,i,d){a.value=l.lat(),i.value=l.lng(),d.value=e.getZoom()}function h(e,l,a,i,d,s){var t=n(a.currentTarget).val();t&&(geocoder=new google.maps.Geocoder,geocoder.geocode({address:t},(p,o)=>{if(n(a).removeClass("ggp-place-found"),n(a).removeClass("ggp-place-failed"),google.maps.GeocoderStatus.OK===o){let c=p[0].geometry.location;l.setPosition(c),e.panTo(c),n(a.currentTarget).addClass("ggp-place-found"),clearTimeout(window.placeFoundTimeout),window.placeFoundTimeout=setTimeout(()=>n(a.currentTarget).removeClass("ggp-place-found"),1e3),f(e,c,i,d,s)}else console.warn("Find a place: "+t+" not found"),n(a.currentTarget).addClass("ggp-place-failed"),clearTimeout(window.placeFailedTimeout),window.placeFailedTimeout=setTimeout(()=>n(a.currentTarget).removeClass("ggp-place-failed"),1e3)})),a.preventDefault(),a.stopPropagation()}function u(){n("[data-goldfinch-google-place-field]").each((e,l)=>{let a=n(l).find('[data-goldfinch-place="data"]');if(a.length&&a.val()){let i=JSON.parse(n(l).find('[data-goldfinch-place="data"]').val()),d=n(l).find('[data-goldfinch-place="preview"]');d.addClass("ggp__preview--display");let s=n("<ul>");i.address_components.forEach((t,p)=>{let o=t.types.join();t.types.includes("subpremise")?o="Subpremise":t.types.includes("street_number")?o="Street number":t.types.includes("route")?o="Street name":t.types.includes("locality")?o="Suburb":t.types.includes("sublocality")?o="Subarea":t.types.includes("administrative_area_level_1")?o="Region":t.types.includes("administrative_area_level_2")?o="District":t.types.includes("country")?o="Country":t.types.includes("postal_code")&&(o="Postcode"),s.append("<li><b>"+o+"</b>: "+t.long_name+"</li>")});let r=i.geometry.location;s.append("<li><b>Latitude</b>: "+r.lat+"</li>"),s.append("<li><b>Longitude</b>: "+r.lng+"</li>"),s.append('<li><a target="_blank" href="https://www.google.com/maps/search/?api=1&query='+r.lat+","+r.lng+'">Open Google Maps</a></li>'),d.html(s)}})}n(document).ready(()=>{u()}),n(".cms-edit-form").entwine({onmatch(e){this._super(e)},onunmatch(e){this._super(e)},onaftersubmitform(e,l){u()}}),n.entwine("ss",function(e){e("[data-goldfinch-google-place-field]").entwine({onmatch:function(){var l=e(this).find('[data-goldfinch-place="address"]')[0],a=e(this).find('[data-goldfinch-place="data"]')[0],i=JSON.parse(e(l).attr("data-settings"));const d={componentRestrictions:{country:i.country},fields:["address_components","geometry","name"],strictBounds:!1},s=new google.maps.places.Autocomplete(l,d);s.addListener("place_changed",()=>{const r=s.getPlace();a.value=JSON.stringify(r),u()})}}),e("[data-goldfinch-google-map-field]").entwine({onmatch:function(){var l=e(this).find('[data-goldfinch-map="latitude"]')[0],a=e(this).find('[data-goldfinch-map="longitude"]')[0],i=e(this).find('[data-goldfinch-map="zoom"]')[0],d=e(this).find('[data-goldfinch-map="frame"]')[0],s=e(this).find('[data-goldfinch-map="search"]')[0],r=JSON.parse(e(d).attr("data-settings"));let t=parseFloat(l.value),p=parseFloat(a.value),o=parseFloat(i.value);o||(o=r.zoom),t||(t=r.lat),p||(p=r.lng);let c=new google.maps.Map(d,{center:{lat:t,lng:p},zoom:o,gestureHandling:"cooperative",fullscreenControl:!1,mapTypeControl:!1,clickableIcons:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!1});var m=new google.maps.Marker({position:{lat:t,lng:p},map:c});google.maps.event.addListener(c,"zoom_changed",g=>{i.value=c.getZoom()}),google.maps.event.addListener(c,"click",g=>{m.setPosition(g.latLng),c.panTo(g.latLng),f(c,g.latLng,l,a,i)}),e(s).on({change:s,keydown:g=>{g.which==13&&h(c,m,g,l,a,i)}})}})})})(jQuery);
